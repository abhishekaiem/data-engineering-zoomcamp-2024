CREATE OR REPLACE EXTERNAL TABLE
  `hardy-pattern-413201.ny_taxi.green_taxi_data` OPTIONS ( format ="parquet",
    uris = ['gs://hardy-pattern-413201-de-zoomcamp/nyc_green_taxi_data-2022.parquet'] );
SELECT
  COUNT(*)
FROM
  `hardy-pattern-413201.ny_taxi.green_taxi_data`
LIMIT
  10;
CREATE OR REPLACE TABLE
  `hardy-pattern-413201.ny_taxi.green_taxi_data_internal` AS
SELECT
  VendorID,
  TIMESTAMP(lpep_pickup_datetime) AS lpep_pickup_datetime,
  TIMESTAMP(lpep_dropoff_datetime) AS lpep_dropoff_datetime,
  store_and_fwd_flag,
  RatecodeID,
  PULocationID,
  DOLocationID,
  passenger_count,
  trip_distance,
  fare_amount,
  extra,
  mta_tax,
  tip_amount,
  tolls_amount,
  ehail_fee,
  improvement_surcharge,
  total_amount,
  payment_type,
  trip_type,
  congestion_surcharge
FROM
  `hardy-pattern-413201.ny_taxi.green_taxi_data`;
SELECT
  DISTINCT PULocationID
FROM
  `hardy-pattern-413201.ny_taxi.green_taxi_data_internal`;
SELECT
  DISTINCT PULocationID
FROM
  `hardy-pattern-413201.ny_taxi.green_taxi_data`;
SELECT
  COUNT(*)
FROM
  `hardy-pattern-413201.ny_taxi.green_taxi_data_internal`
WHERE
  fare_amount=0;
SELECT
  DISTINCT PULocationID
FROM
  `hardy-pattern-413201.ny_taxi.green_taxi_data_internal`
WHERE
  DATE(lpep_pickup_datetime) BETWEEN '2022-06-01'AND '2022-06-30';
CREATE OR REPLACE TABLE
  `hardy-pattern-413201.ny_taxi.green_taxi_data_internal_partitioned_clustered`
PARTITION BY
  DATE(lpep_pickup_datetime)
CLUSTER BY
  PULocationID AS
SELECT
  *
FROM
  `hardy-pattern-413201.ny_taxi.green_taxi_data_internal` ;
SELECT
  DISTINCT PULocationID
FROM
  `hardy-pattern-413201.ny_taxi.green_taxi_data_internal_partitioned_clustered`
WHERE
  DATE(lpep_pickup_datetime) BETWEEN '2022-06-01'AND '2022-06-30';